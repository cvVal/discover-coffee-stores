// NEARBY STORES CACHING IMPLEMENTATION SUMMARY
// ================================================

/\*\*

- 1.  PERSISTENT CACHING SYSTEM
- - Uses localStorage to persist nearby stores between page navigations
- - Automatically loads cached stores on component mount
- - Maintains store data when navigating to/from detail pages
-
- 2.  DATABASE SYNCHRONIZATION
- - Syncs cached stores with latest voting data from Airtable database
- - API endpoint (/api/syncStoresWithDatabase) handles database queries
- - Merges fresh voting data with cached store information
-
- 3.  SMART REFRESH MECHANISMS
- - Automatic refresh on page visibility change (coming back from detail page)
- - Automatic refresh on window focus
- - Manual refresh button for user-initiated updates
- - Debounced refresh to prevent excessive API calls
- - Timestamp-based throttling (30-second minimum between refreshes)
-
- 4.  REAL-TIME VOTING UPDATES
- - Listens for custom 'votingUpdated' events from upvote component
- - Only refreshes cached stores when a nearby store receives a vote
- - Optimistic UI updates with database synchronization
-
- 5.  ENHANCED USER INTERFACE
- - Loading states for sync operations
- - Clear cache functionality
- - Visual indicators for sync status
- - Refresh and clear cache buttons
-
- HOW IT WORKS:
-
- 1.  User clicks "View stores nearby" button
- 2.  System fetches nearby stores from location API
- 3.  Stores are cached in localStorage and Context
- 4.  System syncs with database to get voting data
- 5.  Cards display with real-time voting counts and ratings
- 6.  When user navigates to detail page and votes:
- - Vote is saved to database
- - Custom event is dispatched
- - Nearby stores context listens for the event
- - Only refreshes if the voted store is in nearby stores
- 7.  When user navigates back to main page:
- - Cached stores are immediately displayed
- - System automatically refreshes database data
- - Updated voting counts are shown
-
- COMPONENTS INVOLVED:
- - /lib/nearby-stores-context.tsx (Main caching logic)
- - /component/nearby-coffee-stores.client.tsx (UI component)
- - /hooks/use-cache-refresh.ts (Auto-refresh logic)
- - /hooks/use-debounce.ts (Performance optimization)
- - /app/api/syncStoresWithDatabase/route.ts (Database sync API)
- - /component/upvote.client.tsx (Voting event dispatch)
-
- TESTING:
- 1.  Click "View stores nearby" to load and cache stores
- 2.  Navigate to a coffee store detail page
- 3.  Vote on the store (notice optimistic UI update)
- 4.  Navigate back to main page (cached stores should appear immediately)
- 5.  Observe updated vote count in the nearby stores section
- 6.  Try clicking "Refresh Votes" to manually sync
- 7.  Try clicking "Clear Cache" to reset and re-fetch
      \*/
